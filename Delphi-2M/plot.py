import matplotlib.pyplot as plt

# Data for kvcache False
tokens = [0, 20, 40, 60, 80, 100, 120, 140, 160, 180, 200, 220, 240, 260, 280, 300, 320, 
          340, 360, 380, 400, 420, 440, 460, 480, 500, 520, 540, 560, 580, 600, 620, 
          640, 660, 680, 700, 720, 740, 760, 780, 800, 820, 840, 860, 880, 900, 920, 
          940, 960, 980, 1000, 1020, 1040, 1060, 1080, 1100]

time_seconds_naive = [1.17, 0.16, 0.27, 0.44, 0.68, 0.89, 1.00, 1.33, 1.57, 1.75, 2.08, 2.39, 
                2.63, 2.89, 3.37, 3.77, 4.00, 4.28, 4.73, 5.41, 5.61, 6.13, 6.95, 7.46, 
                7.96, 8.38, 8.96, 9.87, 10.85, 11.61, 12.53, 13.88, 14.74, 15.85, 16.67, 
                18.00, 19.16, 20.38, 18.94, 24.81, 27.30, 27.43, 29.25, 31.45, 33.78, 
                37.01, 40.16, 51.50, 86.63, 106.96, 138.89, 187.60, 224.29, 256.98, 
                290.05, 329.27]

time_seconds_cache = [0.68, 0.13, 0.21, 0.32, 0.43, 0.64, 0.77, 0.88, 1.11, 1.34, 1.45, 1.78, 2.08, 
                2.45, 2.69, 3.18, 3.58, 4.26, 4.95, 5.33, 6.17, 8.61, 8.05, 9.28, 11.81, 
                10.75, 11.46, 12.36, 13.58, 14.66, 17.85, 16.59, 17.57, 19.66, 20.52, 22.46, 
                23.77, 23.59, 28.37, 26.22, 25.99, 27.06, 28.42, 30.17, 31.13, 34.66, 37.28, 
                52.18, 71.23, 105.82, 143.39, 171.50, 208.88, 239.82, 266.48, 301.58]

# Times for kvcache True
times_true = [0.68, 0.12, 0.24, 0.40, 0.73, 1.11, 1.46, 1.94, 2.58, 3.35, 3.62, 4.52, 5.12, 5.44, 6.18, 
              7.60, 8.03, 8.62, 9.21, 10.15, 11.54, 12.24, 13.48, 14.75, 14.94, 16.49, 17.56, 18.54, 22.32, 
              23.47, 24.80, 26.15, 27.56, 28.93, 30.97, 32.10, 34.43, 35.51, 37.11, 40.18, 42.14, 43.90, 45.37, 
              47.79, 50.33, 51.81, 55.42, 59.02, 85.93, 109.92]

# Times for kvcache False
times_false = [0.40, 0.16, 0.30, 0.49, 0.77, 0.97, 1.04, 1.50, 1.66, 2.10, 2.34, 2.78, 3.24, 3.63, 4.08, 
               3.92, 4.45, 5.96, 6.33, 7.24, 7.86, 8.46, 10.60, 9.50, 10.50, 11.16, 13.23, 14.54, 14.67, 
               16.14, 17.65, 19.30, 21.47, 16.80, 17.26, 19.55, 20.10, 21.26, 22.87, 24.95, 26.59, 28.03, 
               30.76, 32.18, 34.68, 35.36, 38.39, 52.58, 90.99, 118.44]

times_4_gpus_naive =  [0.12, 0.10, 0.16, 0.26, 0.31, 0.46, 0.60, 0.71, 0.90, 0.95, 1.10, 1.29, 1.51, 
    1.57, 1.87, 2.16, 2.38, 3.40, 2.80, 4.00, 3.16, 3.59, 3.79, 5.07, 4.49, 4.66, 
    5.22, 5.38, 6.00, 5.71, 6.93, 7.61, 7.06, 7.99, 8.73, 9.05, 9.49, 10.42, 10.12, 
    10.76, 11.67, 12.49, 13.09, 13.87, 14.48, 15.05, 15.51, 18.25, 18.28, 21.27, 
    21.79, 23.82, 23.36, 25.10, 25.96, 29.67]

times_4_gpus_cache = [
    0.05, 0.09, 0.13, 0.18, 0.24, 0.30, 2.75, 0.51, 0.58, 0.69, 0.77, 1.01, 1.01, 
    1.14, 1.29, 1.59, 1.60, 1.81, 2.03, 2.28, 2.36, 2.75, 2.73, 2.95, 3.15, 3.27, 
    3.49, 3.96, 5.30, 4.36, 4.86, 5.73, 5.57, 5.75, 6.24, 6.85, 7.26, 7.35, 8.23, 
    9.93, 9.59, 10.66, 10.46, 12.63, 13.61, 12.87, 12.20, 14.36, 14.49, 17.18, 
    15.59, 16.39, 17.40, 18.29, 18.34, 20.54
]


times_8_gpus_naive = [0.42, 0.10, 0.17, 0.27, 0.42, 0.72, 1.31, 9.32, 4.17, 6.12, 7.31, 
            6.35, 7.46, 7.25, 8.06, 8.92, 9.71, 11.40, 11.31, 13.79, 15.36, 15.31, 
            15.59, 17.17, 18.27, 18.87, 19.72, 23.06, 22.83, 24.88, 27.76, 28.12, 
            29.05, 28.44, 25.13, 32.53, 34.77, 33.45, 40.10, 39.75, 44.77, 42.64, 
            45.84, 46.68, 52.34, 73.11, 56.66, 55.72, 57.90, 59.09, 63.47, 66.30, 
            66.49, 84.43, 84.98, 123.11]


times_8_gpus_cache = [0.49, 0.17, 0.14, 0.25, 0.35, 0.39, 1.00, 1.39, 1.23, 2.13, 
                1.67, 2.00, 1.68, 6.43, 4.67, 2.29, 5.61, 9.40, 5.79, 5.12, 7.39, 
                6.72, 5.76, 7.94, 6.72, 8.02, 8.90, 8.78, 9.38, 9.40, 9.19, 10.16, 
                11.45, 12.16, 13.98, 13.59, 16.37, 15.34, 15.21, 18.15, 14.88, 18.17, 
                18.68, 20.92, 20.07, 21.81, 21.17, 28.06, 25.45, 31.87, 26.08, 27.26, 
                31.38, 31.55, 52.08, 61.06]

times_16_gpus_naive = [
    0.81, 0.17, 2.85, 1.53, 0.61, 1.43, 2.20, 3.78, 3.87, 4.10, 5.25, 7.05, 6.23, 
    7.53, 8.37, 9.00, 9.92, 11.72, 11.32, 12.72, 14.77, 14.99, 14.98, 16.89, 18.74, 
    19.33, 20.99, 22.40, 23.88, 25.02, 25.37, 28.00, 28.82, 29.22, 28.44, 32.42, 
    33.95, 36.19, 40.10, 38.31, 43.69, 43.09, 48.52, 48.38, 50.67, 53.11, 53.51, 
    55.11, 56.06, 58.40, 63.17, 69.63, 66.38, 73.63, 109.19, 81.43
]

times_16_gpus_cache = [
    0.06, 0.46, 1.09, 3.37, 1.73, 1.78, 5.92, 1.62, 1.96, 4.97, 5.00, 2.41, 3.22, 
    2.60, 3.20, 2.54, 2.98, 4.52, 5.03, 5.20, 5.37, 5.38, 6.46, 6.22, 8.20, 7.98, 
    7.04, 7.61, 8.57, 9.56, 11.45, 10.49, 12.03, 13.25, 12.44, 15.42, 15.92, 17.13, 
    17.44, 19.33, 22.16, 18.16, 19.51, 20.96, 25.73, 25.11, 23.38, 27.61, 27.97, 
    60.95, 27.35, 30.32, 30.98, 30.39, 47.19, 24.32
]


time_kvcache_false_gpu = [0.82, 0.01, 0.01, 0.02, 0.03, 0.04, 0.05, 0.03, 0.03, 0.04, 0.05, 0.05, 0.10, 0.06, 0.06, 0.18, 0.07, 0.07, 0.07, 0.08, 0.09, 0.09, 0.09, 0.10, 0.10, 0.11, 0.25, 0.12, 0.12, 0.13, 0.31, 0.14, 0.28, 0.15, 0.16, 0.16, 0.53, 0.17, 0.18, 0.18, 0.19, 0.31, 0.20, 0.21, 0.21, 0.63, 0.67, 0.99, 0.70, 0.74, 0.25, 0.69, 0.64, 0.65, 0.88, 0.70]
time_kvcache_true_gpu = [0.10, 0.19, 0.02, 0.01, 0.02, 0.02, 0.02, 0.02, 0.03, 0.03, 0.03, 0.04, 0.04, 0.04, 0.05, 0.05, 0.05, 0.06, 0.06, 0.07, 0.07, 0.07, 0.07, 0.08, 0.08, 0.09, 0.09, 0.10, 0.10, 0.10, 0.11, 0.11, 0.11, 0.12, 0.12, 0.13, 0.13, 0.14, 0.14, 0.14, 0.15, 0.15, 0.16, 0.16, 0.16, 0.17, 0.17, 0.18, 0.18, 0.19, 0.19, 0.20, 0.21, 0.21, 0.22, 0.22]

time_kvcache_true_gpu2 = [
    0.95, 0.01, 0.01, 0.02, 0.02, 0.03, 0.04, 0.06, 0.05, 0.06,
    0.05, 0.05, 0.06, 0.06, 0.07, 0.07, 0.08, 0.08, 0.09, 0.09,
    0.10, 0.10, 0.11, 0.11, 0.17, 0.12, 0.13, 0.14, 0.14, 0.15,
    0.15, 0.15, 0.17, 0.19, 0.44, 0.18, 0.20, 0.20, 0.21, 0.22,
    0.22, 0.23, 0.24, 0.65, 0.25, 0.26, 0.73, 0.27, 0.62, 0.29,
    0.53, 0.54, 0.59, 0.58, 0.60, 0.64
]

time_kvcache_false_gpu2 = [
    0.12, 0.01, 0.02, 0.02, 0.03, 0.03, 0.04, 0.04, 0.05, 0.05,
    0.06, 0.06, 0.07, 0.08, 0.08, 0.09, 0.10, 0.10, 0.11, 0.12,
    0.12, 0.13, 0.14, 0.14, 0.15, 0.16, 0.16, 0.18, 0.18, 0.19,
    0.19, 0.20, 0.22, 0.23, 0.23, 0.24, 0.25, 0.26, 0.26, 0.27,
    0.29, 0.29, 0.30, 0.31, 0.32, 0.33, 0.34, 0.34, 0.37, 0.37,
    0.38, 0.39, 0.41, 0.42, 0.43, 0.44
]

tokens_long = [
    0, 20, 40, 60, 80, 100, 120, 140, 160, 180, 200, 220, 240, 260, 280, 300, 320, 340, 360, 380, 400, 420, 440, 460, 480, 
    500, 520, 540, 560, 580, 600, 620, 640, 660, 680, 700, 720, 740, 760, 780, 800, 820, 840, 860, 880, 900, 920, 940, 960, 
    980, 1000, 1020, 1040, 1060, 1080, 1100, 1120, 1140, 1160, 1180, 1200, 1220, 1240, 1260, 1280, 1300, 1320, 1340, 1360, 
    1380, 1400, 1420, 1440, 1460, 1480, 1500, 1520, 1540, 1560, 1580, 1600, 1620, 1640, 1660, 1680, 1700, 1720, 1740, 1760, 
    1780, 1800, 1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000
]

time_kvcache_true_gpu3 = [
    0.67, 0.01, 0.01, 0.02, 0.01, 0.01, 0.01, 0.02, 0.01, 0.03, 0.01, 0.01, 0.02, 0.02, 0.02, 0.02, 0.03, 0.02, 0.02, 0.02, 
    0.02, 0.02, 0.02, 0.05, 0.03, 0.03, 0.03, 0.03, 0.03, 0.06, 0.03, 0.03, 0.03, 0.03, 0.03, 0.04, 0.04, 0.04, 0.04, 0.04, 
    0.04, 0.04, 0.04, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.09, 0.05, 0.06, 0.11, 0.06, 0.35, 0.11, 0.06, 0.06, 
    0.06, 0.07, 0.12, 0.07, 0.07, 0.07, 0.29, 0.07, 0.08, 0.28, 0.08, 0.08, 0.08, 0.08, 0.09, 0.09, 0.24, 0.09, 0.09, 0.39, 
    0.09, 0.09, 0.10, 0.21, 0.10, 0.11, 0.20, 0.11, 0.42, 0.11, 0.45, 0.11, 0.12, 0.12, 0.12, 0.12, 0.60, 0.12, 0.44, 0.12, 
    0.61, 0.13, 0.13
]

time_kvcache_false_gpu3 = [
    0.22, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.03, 0.03, 
    0.03, 0.03, 0.03, 0.03, 0.03, 0.03, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.05, 0.05, 0.05, 0.05, 0.05, 
    0.05, 0.05, 0.05, 0.06, 0.06, 0.06, 0.06, 0.06, 0.06, 0.06, 0.06, 0.07, 0.07, 0.07, 0.07, 0.07, 0.07, 0.07, 0.07, 0.08, 
    0.08, 0.08, 0.08, 0.08, 0.08, 0.08, 0.08, 0.09, 0.09, 0.09, 0.09, 0.09, 0.09, 0.09, 0.09, 0.10, 0.10, 0.10, 0.10, 0.10, 
    0.10, 0.10, 0.10, 0.11, 0.11, 0.11, 0.11, 0.11, 0.11, 0.11, 0.11, 0.12, 0.12, 0.12, 0.12, 0.12, 0.12, 0.12, 0.12, 0.13, 
    0.13, 0.13, 0.13, 0.13, 0.13, 0.13, 0.13, 0.14, 0.14, 0.14, 0.14, 0.14, 0.14, 0.14, 0.14, 0.15, 0.15, 0.15, 0.15, 0.15, 
    0.15, 0.15, 0.15, 0.16, 0.16, 0.16, 0.16, 0.16, 0.16, 0.16, 0.16, 0.17, 0.17, 0.17, 0.17, 0.17, 0.17
]

time_kvcache_true_gpu4 = [
    0.70, 0.01, 0.01, 0.02, 0.01, 0.01, 0.01, 0.02, 0.01, 0.02, 0.01, 0.02, 0.01, 0.02, 0.01, 0.01, 0.02, 0.02, 0.02, 0.02, 
    0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.03, 0.05, 0.03, 0.03, 0.03, 0.03, 0.11, 0.03, 0.03, 0.03, 0.04, 0.08, 0.04, 0.09, 
    0.13, 0.04, 0.04, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.09, 0.05, 0.06, 0.11, 0.06, 0.35, 0.11, 0.06, 0.06, 0.06, 
    0.07, 0.12, 0.07, 0.07, 0.07, 0.29, 0.07, 0.08, 0.28, 0.08, 0.08, 0.08, 0.08, 0.09, 0.09, 0.24, 0.09, 0.09, 0.39, 0.09, 
    0.09, 0.10, 0.21, 0.10, 0.11, 0.20, 0.11, 0.42, 0.11, 0.45, 0.11, 0.12, 0.12, 0.12, 0.12, 0.60, 0.12, 0.44, 0.12, 0.61, 
    0.13, 0.13
]

time_kvcache_false_gpu4 = [
    0.02, 0.01, 0.01, 0.01, 0.01, 0.02, 0.01, 0.02, 0.01, 0.02, 0.01, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.03, 
    0.03, 0.03, 0.03, 0.03, 0.03, 0.03, 0.03, 0.03, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.05, 0.05, 0.05, 
    0.05, 0.06, 0.05, 0.05, 0.06, 0.06, 0.06, 0.06, 0.07, 0.07, 0.07, 0.07, 0.07, 0.07, 0.07, 0.08, 0.08, 0.08, 0.08, 0.08, 
    0.08, 0.08, 0.09, 0.09, 0.09, 0.09, 0.09, 0.09, 0.09, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.11, 0.11, 0.11, 0.11, 
    0.11, 0.11, 0.11, 0.12, 0.12, 0.12, 0.12, 0.12, 0.12, 0.12, 0.13, 0.13, 0.13, 0.13, 0.13, 0.13, 0.13, 0.14, 0.14, 0.14, 
    0.14, 0.14, 0.14, 0.14, 0.15, 0.15, 0.15, 0.15, 0.15, 0.15, 0.15, 0.16, 0.16, 0.16, 0.16, 0.16, 0.16, 0.16, 0.17, 0.17, 
    0.17, 0.17, 0.17, 0.17
]


# Plot results
plt.figure(figsize=(10, 6))
plt.plot(tokens_long, time_kvcache_false_gpu3, label='Naive (No Cache)', linestyle='--')    
plt.plot(tokens_long, time_kvcache_true_gpu3, label='With Cache', linestyle='--')
plt.plot(tokens_long, time_kvcache_false_gpu4, label='Naive (No Cache) 2', linestyle=':')    
plt.plot(tokens_long, time_kvcache_true_gpu4, label='With Cache 2', linestyle=':')
#plt.plot(tokens, times_16_gpus_naive, label='Naive (No Cache) 16 gpus')    
#plt.plot(tokens, times_16_gpus_cache, label='With Cache 16 gpus')
plt.xlabel('Sequence Length')
plt.ylabel('Time to generate the next token (seconds)')
plt.title('Benchmarking Sampling Speed with and without KV Cache with batch size 2')
plt.legend()
plt.grid(True)
# Save the plot to a file
plt.savefig('benchmarking_results.png')

